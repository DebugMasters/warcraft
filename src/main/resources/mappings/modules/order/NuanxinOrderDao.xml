<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fenghuolun.modules.order.dao.NuanxinOrderDao">
	
	<!-- 查询数据 -->
	<select id="findList" resultType="NuanxinOrder">
		SELECT ${sqlMap.column.toSql()}, 
			b.user_name AS "userName", 
			c.character_account_name AS "accountName", 
			d.realm_name AS "realmName", 
			d.realm_zone_name AS "realmZone", 
			d.realm_type AS "realmType", 
			e.dict_label AS "characterClassName" 
		FROM ${sqlMap.table.toSql()}
		LEFT JOIN nuanxin_user b ON a.user_id = b.user_id 
		LEFT JOIN nuanxin_character c ON a.character_id = c.character_id 
		LEFT JOIN nuanxin_realm_list d ON c.character_realm = d.realm_id 
		LEFT JOIN js_sys_dict_data e ON c.character_class = e.dict_value AND e.dict_type = 'nx_character_class' 
		<where>
			${sqlMap.where.toSql()}
			<if test="realmName != null and realmName != ''">
				AND d.realm_name = #{realmName} 
			</if>
		</where>
		ORDER BY ${sqlMap.order.toSql()}
	</select>
	
	<select id="orderList" resultType="NuanxinOrder">
		SELECT a.*, 
			b.user_name AS "userName", 
			c.character_account_name AS "accountName", 
			d.realm_name AS "realmName", 
			d.realm_zone_name AS "realmZone", 
			d.realm_type AS "realmType", 
			e.dict_label AS "characterClassName" 
		FROM nuanxin_order a 
		LEFT JOIN nuanxin_user b ON a.user_id = b.user_id 
		LEFT JOIN nuanxin_character c ON a.character_id = c.character_id 
		LEFT JOIN nuanxin_realm_list d ON c.character_realm = d.realm_id 
		LEFT JOIN js_sys_dict_data e ON c.character_class = e.dict_value AND e.dict_type = 'nx_character_class' 
		<where>
			<if test="userId != null and userId != ''">
				AND a.user_id = #{userId} 
			</if>
		</where>
	</select>
	
	<select id="todaysOrder" resultType="java.lang.Long">
		SELECT COUNT(1) FROM nuanxin_order
		WHERE TO_DAYS(create_time) >= TO_DAYS(NOW())
	</select>
</mapper>